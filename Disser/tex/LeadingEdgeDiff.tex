\subsection{FLES}\label{sec:secFLES}

Рассмотрим систему считывания и сбора данных ``традиционного'' эксперимента.

%Условно можно разделить электронику на переднюю и остальную. Основная задача передней электроники - оцифровать аналоговый выходной сигнал детектирующего устройства. На выходе передней электроники получается логический сигнал, который затем преобразовывается в цифровой. (Это неверно для случая, когда сигнал непрерывно семплируется) Далее могут работать концентраторы данных и какие-то ещё платы, обеспечивающие приём данных в ЭВМ. Таким принимающим устройством может быть обычный сетевой интерфейс, работающий с Ethernet. В CBM это не так, поэтому нужен FLIB.

Каждый канал передней электроники имеет выходной буфер, куда по принципу FIFO складываются оцифрованные входные сигналы. В экспериментальной установке присутствуют дететоры, вырабатывающие триггер --- сигнал, который заводится (условно) на каждый канал считывания, и говорит о том, что произошло интересное событие, которое необходимо сохранить для последующей обработки. Данный подход имеет свои причины. Во-первых, до недавнего времени физические эксперименты не требовали высоких частот регистрации --- выполнение физической программы при относительно низких частотах первичного взаимодействия было осуществимо в разумные сроки. Во-вторых, многие регистрирующие приборы имеют заметное ``мёртвое время'' --- время, в течение которого прибор не может обрабатывать входные сигналы. Следовательно, если канал регистрирует ложный входной сигнал, велика вероятности того, что будет пропущен полезный сигнал.

С развитием электроники ``мёртвое время'' уменьшалось. Более того, возможность применения принципиально другой считывающей электроники, как например чисто временной канал, реализованный в ППВМ, для обработки сигналов с МА~ФЭУ в CBM~RICH, исследуемая в данной работе, позволяет на порядки снизить ``мёртвое время'' и повысить точность регистрации временной отметки в ущерб полноты информации.

(Сюда подмешивается секция 2.2)

В CBM планируется использование программного триггера. Это означает, что для того, чтобы принять решение, сохранять принятые данные или нет, необходимо выполнить полную реконструкцию события, включая реконструкцию треков, которая является высоко-затратной задачей. Рассматривается также возможность на определённых этапах работы установки использовать для выработки триггера частичную реконструкцию. Например исследуется возможность триггирования по результатам реконструкций треков только в MUCH, когда стоит задача поиска (такой-то частицы).

В ``традиционном'' эксперименте триггер может формроваться в результате логических операций над сигналами с нескольких детекторов, реализованных аппаратно. Такая логика работает за (масштаб времени). Реконструкция треков выполняется за гораздо большее время (на столько-то порядков выше). По этой причине необходимо иметь не только буфер в электронике --- его будет недостаточно. 

Сказать о том, что нужно хорошо настраивать пороги.

Всё вместе привело к разработке FLES. Электроника бестриггерная, несколько уровней концентрации данных, многочисленные буферы, формирование срезов времени, построение интервалов и только после этого мы переходим к построению событий.

(Картинка, где показана схема для частичного триггера, вроде бы от Вальтера)

\subsection{Построение события}\label{sec:secEventBuilding}

Тот факт, что физическая программа эксперимента CBM подразумевает исследование очень редких явлений, для которых практически невозможно вырабатывать аппаратный триггер, привёл к решению разработать и использовать бестриггерную систему считывания. В бестриггерной системе считывания каждый канал передней электроники вырабатывает сообщение при преодолении входным аналоговым сигналом установленного порога. Получается, что электроника выдаёт для программного обеспечения непрерывный поток никак не сгруппированных сообщений, содержащих временную отметку. Для того, чтобы выполнять физический анализ, необходимо в этом непрерывном потоке выделять осмысленные группы, которые мы называем событиями. Строго говоря, задача построения событий --- это одномерная задача кластеризации на оси времени с последующим отбором кластеров по некоторым критериям.

Задача также усложнена тем фактом, что электроника не может обеспечить непрерывный поток сообщений, упорядоченных по времени регистрации. Происходит группировка сообщений в так называемые DAQ-события, которые необходимы для обеспечения передачи информации, а сообщения внутри DAQ-событий могут быть упорядочны произвольно. Соответственно первый этап построения события --- упорядочивание сообщений.

В данных с пучковых тестов 2014~г., для того, чтобы определить, является ли распознанная группа событием, можно использовать сигналы с детекторов пучка --- пороговых черенковских счётчиков, годоскопов и др. В лабораторных данных, где выполнялись измерения с лазером, в качестве триггера можно использовать сигнал от генератора, управляющего лазером. В ситуации, когда нет дополнительной информации, как в случае полного детектора RICH в итоговом эксперименте, необходимо принимать решение о том, является распознанная группа событием, или нет, на основе исключительно информации, полученной из этой группы. Распознанный кластер может являться событием, но чаще всего будет состоять из одного сообщения --- шумового хита. Следовательно можно использовать кол-во хитов в событии для подавления шумов, что особенно актуально для дететора CBM~RICH, где выполняется реконструкция черенковских колец, требующая некоторого минимального числа хитов в плоскости реконструкции.

(Сначала общая идея, что в любом случае будет некоторое временное окно и все сообщения попадающие в окно формируют событие. Размеры окна --- один из параметров построителя событий, которым можно играть с целью повышения эффективности.)

(А здесь можно описать предлагаемый алгоритм)

\subsection{LeadingEdgeDiff}\label{sec:secLeadingEdgeDiff}

Один из этапов обработки данных --- построение событий. В данной работе рассматривается два типа событий --- сигналы от лазера и сигналы от черенковского кольца. В любом случае, событие --- это структура данных, содержащая информацию о хитах, сгруппированных по времени. Каждый хит содержит, как минимум, временную отметку момента прихода переднего фронта сигнала и номер канала, который в случае CBM~RICH указывает номер пикселя фоточувствительной камеры, т.е. говорит о геометрическом положений зарегистрированного фотона.

Данное исследование посвящено, в первую очередь, временным характеристикам системы считывания, поэтому в основном речь пойдёт о временных отметках.

Т.к. событие имеет максимальную ширину, определяемую размерами окна в алгоритме построения событий, распределения могут иметь ``обрезанные хвосты'', которые, однако, невозможно избежать.

Очевидно, что для каждого события можно построить несколько распределений, которые на большом массиве данных, т.е. на многих событиях, характеризуют систему считывания и могут быть использованы для калибровки электроники с целью повышения временного разрешения системы.

Пусть событие содержит N хитов. Введём внутри события нумерацию хитов от 0 до N. Пусть внутри события хиты упорядочены по времени, т.е. хит с временной отметкой $ t_{0} $ был зарегистрирован раньше остальных, а хит с временной отметкой $ t_{N} $ --- позже всех. Такой порядок может, например, обеспечиваться естественным образом алгоритмом построения событий. Введём в рассмотрение распределение $ \omega $ разностей временных отметок всех хитов, кроме первого, относительно первого, т.е. распределение $ t_{j} - t_{0} $, где  $ j \in [1..N] $. Также введём распределение $ \sigma $ всех пар временных отметок одного события, т.е. $ t_{j}-t_{i} $, где $ i \in [0..N], j \in [0..N], i \neq j $.

В идеальной ситуации, если событие соответствует одной вспышке лазера или одному черенковскому кольцу, и отсутствуют факторы, размывающие время регистрации, все разницы были бы равны нулю. В качестве таких размывающих факторов можно привести, например, следующие: временные характеристики лазера, разброс геометрических путей черенковских фотонов, разброс времени прохождения электронной лавины в динодной системе ФЭУ, дребезг сигналов в передней электронике. Из-за перечисленных явлений распределение $ \omega $ имеет следующую форму --- (описание). Распределение $ \sigma $ --- (описание).

%Влияние всех этих явлений выливается в то, что распределение $ \sigma $ имеет колоколообразную форму. Среднее значение либо положение масимума можно использовать для того, чтобы определить значение поправки для данной пары каналов.

Представляется возможность анализировать различные области фоточувствительной камеры. Интересно группировать хиты в соответствии с тем, какой электроникой они обрабатываются. В данном анализе было введено 4 подмножества: 1~пара каналов, 16~каналов одной платы передней электроники, 64~канала одного МА~ФЭУ, 256~каналов 4~МА~ФЭУ, образующих площадку 2х2~МА~ФЭУ в одном углу камеры. При том, что вся фоточувствительная камера на пучковых тестах имела размер 4х4~МА~ФЭУ, рассматривать более 4~МА~ФЭУ одновременно не имеет смысла, т.к. в прототипе были установлены различные модели МА~ФЭУ, некоторые покрытые сместителем спектра, а некоторые нет.

